---
title: "Surface Roughness"
author: "Jared Stabach, Smithsonian Conservation Biology Institute"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: 
      collapsed: false
      smooth_scroll: true
    number_sections: false
    #theme: united
    #highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Calculate Surface Roughness

We assumed that Addax would select inter-dunal depressions. Instead of including the raw SRTM (elevation) data in our models, we created a variable from the raw elevation termed *Surface Roughness*. This variable is the change in elevation range between pixels. That is, it is the difference between the minimum and maximum values of a cell and its eight surrounding neighbors. Pixels with similar neighborhood values have a low change in elevation range (e.g., flat areas), whereas highly variables neighborhoods have a large change in elevation range (e.g., steep slopes) (Wilson, Oâ€™Connell, Brown, Guinan, & Grehan, 2007).

Wilson, M.F.J., O'Connell, B., Brown, C., Guinan, J.C., Grehan, A.J., 2007. Multiscale terrain analysis of multibeam bathymetry data for habitat mapping on the continental slope. Marine Geodesy 30: 3-35.

Original data were downloaded from [EarthExplorer](http://earthexplorer.usgs.gov/). Additional information on SRTM can be found [here](https://lta.cr.usgs.gov/SRTMVF). I selected a study area window and the data product in the [EarthExplorer](http://earthexplorer.usgs.gov/) application. The data were then bulk downloaded using the USGS [bda](https://earthexplorer.usgs.gov/bulk/) tool. 

30-m data often have no data areas (i.e., "holes"). These are errors that must be further processed. To fill these areas, I also downloaded an ancillary dataset (the 90-m SRTM gap-filled product (also available on the[EarthExplorer}(http://earthexplorer.usgs.gov/) site). In ArcGIS, I used a conditional statement to fill the no data areas with the 90-meter data (con(IsNull(srtm_30m),srtm_90m,srtm_30m). Data were projected to UTM Zone 32 North, WGS84 datum (30-meter spatial resolution). 

### Load Libraries

```{r Lib, eval=T, warning=F, message=F}
# Remove everything in memory
rm(list=ls())

# Load raster and rgdal library
library(raster)
library(sp)
library(rgdal)
library(proj4)
```

### Load Data

Make sure your working directory is set to load the raster datasets in this excercise (`getwd()`), otherwise use the `setwd()` command.  Load a sample of the full srtm dataset.

```{r Load, eval=T}
# Load the 30-m SRTM dataset
srtm <- raster("Data/srtm_30m")
```

Now load the spatial points dataset

```{r Spatial Data, eval=T}

# Load the point data
Sub <- readOGR(dsn="Data", layer="Clipped_Add")

# Look at the file
head(Sub)
```

Plot the results

```{r PlotSRTM, eval=T}
# Plot the result
plot(srtm)
plot(Sub,pch=15,cex=0.7,add=TRUE)
```

### Generate Terrain Variable

Variables terrain variables can be applied to elevation datasets.  These include calculating the slope, aspect, Terrain Position Index (TPI), Terrain Ruggedness Index (TRI), and surface roughness.  Use `help(terrain)` for additional information.

```{r Roughness, eval = T}
rough <- terrain(srtm,opt='roughness')
plot(rough)
````

### Variable 

The `extract` command is extremely useful for joining point values from underlying datasets.  These values can easily be appended to your existing dataframe and used in analyses.

```{r Extract, eval=T}
# Extract SRTM mean values within a 2.5 km buffer of each point location.  
Sub$ROUGH <- extract(rough,Sub,method='simple',buffer=2500,fun=mean)

# How is this different than just extracting at the point?
Sub$RGH_PT <- extract(rough,Sub)

# Look at the data
head(Sub)
```
